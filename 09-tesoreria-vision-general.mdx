# Tesorer√≠a y Cobros - Visi√≥n General

El m√≥dulo de **Tesorer√≠a** es el centro financiero de tu cl√≠nica dental. Aqu√≠ controlas ingresos, egresos, pagos de pacientes y la salud financiera de tu negocio.

---

## ¬øQu√© Puedes Hacer en Este M√≥dulo?

### Control Financiero

- **Dashboard**: Vista general de ingresos, gastos y balance
- **Cajas y bancos**: Gesti√≥n de efectivo y cuentas bancarias
- **Monedas**: Manejo de m√∫ltiples divisas (Peso, D√≥lar)
- **Gastos**: Registro de egresos operativos

### Cobros y Pagos

- **Registrar pagos**: Cobros de pacientes por tratamientos
- **Recibos**: Generaci√≥n autom√°tica de comprobantes
- **Balance del paciente**: Deuda actual de cada paciente
- **Historial**: Todos los pagos realizados

### Reportes Financieros

- **Reporte de ventas**: Ingresos por per√≠odo
- **Reporte de deudores**: Pacientes con saldo pendiente
- **Reporte de balance**: Ingresos vs egresos
- **Reporte de movimientos**: Transacciones por caja
- **Reporte de ingresos**: An√°lisis de cobranzas
- **Reporte de personal**: Producci√≥n por doctor

## Divisas y Monedas

Ocl√º CRM soporta el manejo de **m√∫ltiples divisas y monedas** para adaptarse a las necesidades de tu cl√≠nica.

### Divisas Soportadas

El sistema acepta las siguientes divisas y monedas:

- **Peso Argentino (ARS)**
- **D√≥lar Estadounidense (USD)**

---

## Acceso al M√≥dulo

### Desde el Men√∫ Lateral

Haz clic en **"Tesorer√≠a"** en el men√∫ lateral para acceder al dashboard.

**Ruta**: `/treasury` **Permisos**: `list_treasury` (generalmente Admin y Secretarias autorizadas)

[IMAGEN: Men√∫ lateral con Tesorer√≠a]

---

## Estructura del M√≥dulo

### 1. Dashboard de Tesorer√≠a (`/treasury`)

Vista principal con resumen financiero.

**Tarjetas de Resumen**:

- **Ingresos del mes**: Total cobrado en el mes actual
- **Gastos del mes**: Total de egresos del mes
- **Balance del mes**: Diferencia (ingresos - gastos)
- **Caja actual**: Efectivo disponible

**Gr√°ficos**:

- Evoluci√≥n de ingresos (√∫ltimos 6 meses)
- Distribuci√≥n de gastos por categor√≠a
- Comparaci√≥n ingresos vs gastos

[IMAGEN: Dashboard de tesorer√≠a con gr√°ficos]

### 2. Cajas y Bancos (`/treasury/accounts/accounts`)

Gesti√≥n de puntos de cobro y cuentas.

**Tipos de Caja**:

- **Caja Efectivo**: Dinero f√≠sico en la cl√≠nica
- **Banco**: Cuentas bancarias
- **Tarjeta**: Terminales de cobro con tarjeta

**Informaci√≥n por Caja**:

- Saldo actual
- Moneda
- Movimientos del d√≠a
- Historial completo

### 3. Gastos (`/treasury/accounts/expenses`)

Registro de todos los egresos de la cl√≠nica.

**Categor√≠as de Gastos**:

- Sueldos de personal
- Insumos odontol√≥gicos
- Servicios (luz, agua, internet)
- Mantenimiento
- Laboratorio externo
- Alquiler
- Otros

**Informaci√≥n de Cada Gasto**:

- Fecha
- Monto
- Categor√≠a
- Descripci√≥n
- M√©todo de pago
- Comprobante (opcional)

### 4. Monedas (`/treasury/currencies`)

Configuraci√≥n de divisas utilizadas.

**Funcionalidades**:

- Ver todas las monedas activas
- Configurar tipo de cambio
- Moneda principal de la cl√≠nica

**Nota**: Generalmente configurado por el administrador.

---

## Registrar un Pago de Paciente

El flujo m√°s com√∫n en tesorer√≠a es registrar cuando un paciente paga.

### Desde Balance del Paciente

**Ruta**: `/patients/:id/balance`

1. **Acceder**:
   - Busca al paciente
   - Ve a la pesta√±a "Balance"
   - Ver√°s resumen de deuda
2. **Informaci√≥n Visible**:
   - Total de presupuestos aprobados
   - Total ya pagado
   - **Saldo pendiente** (lo que falta pagar)
   - Historial de pagos previos
3. **Registrar Pago**:
   - Clic en bot√≥n **"Registrar Pago"** (verde)
   - Se abre modal de pago

[IMAGEN: Pantalla de balance del paciente]

### Modal de Registro de Pago

**Campos del formulario**:

#### Monto\*

- Cantidad que el paciente est√° pagando
- No puede exceder el saldo pendiente
- Puede ser pago parcial o total

#### Moneda\*

- Seleccionar divisa (Peso, D√≥lar, etc.)
- Si es diferente a la principal, se aplica tipo de cambio

#### M√©todo de Pago\*

Opciones comunes:

- **Efectivo**: Dinero en mano
- **Tarjeta de D√©bito**
- **Tarjeta de Cr√©dito**
- **Transferencia Bancaria**
- **Mercado Pago** (u otros digitales)

#### Caja de Destino\*

- D√≥nde se registra el dinero
- Ej: "Caja Principal", "Banco Santander", "Terminal POS"

#### Fecha de Pago\*

- Por defecto: Fecha actual
- Modificable si registras pagos atrasados

#### Presupuesto Asociado

- Seleccionar a qu√© presupuesto aplicar el pago
- Si el paciente tiene m√∫ltiples presupuestos activos

#### Observaciones (Opcional)

- Notas adicionales sobre el pago
- Ej: "Pago cuota 2 de 6", "Se√±a del tratamiento"

**Botones**:

- **Guardar y Generar Recibo**: Registra y muestra recibo
- **Solo Guardar**: Registra sin imprimir
- **Cancelar**: Cierra sin guardar

[IMAGEN: Modal de registro de pago]

### Despu√©s de Registrar

1. El pago se guarda en el sistema
2. Se actualiza el balance del paciente
3. Se registra el movimiento en la caja seleccionada
4. (Opcional) Se genera recibo autom√°tico

---

## Recibo de Pago

Cada pago genera un **recibo** que sirve como comprobante.

### Informaci√≥n en el Recibo

- **N√∫mero de recibo**: Identificador √∫nico (ej: REC-001)
- **Fecha de emisi√≥n**
- **Datos de la cl√≠nica**: Nombre, direcci√≥n, contacto
- **Datos del paciente**: Nombre, documento
- **Detalle del pago**:
  - Monto pagado
  - Moneda
  - M√©todo de pago
  - Concepto (presupuesto asociado)
- **Saldo anterior y saldo actual**
- **Firma o sello de la cl√≠nica**

### Acciones con Recibos

- **Ver**: Visualizar en pantalla
- **Imprimir**: Formato listo para impresora
- **Descargar PDF**: Guardar o enviar por email
- **Reenviar**: Enviar por email al paciente

**Ruta**: `/payments/receipt/:receiptId`

[IMAGEN: Ejemplo de recibo de pago]

---

## Reportes Financieros

### 1. Reporte de Ventas (`/treasury/reports/sales`)

**Qu√© muestra**: Todos los pagos recibidos en un per√≠odo.

**Filtros**:

- Rango de fechas
- Doctor (producci√≥n por profesional)
- M√©todo de pago
- Moneda

**Informaci√≥n**:

- Lista de todos los pagos
- Monto por pago
- Paciente
- Fecha
- **Total del per√≠odo**

**Uso t√≠pico**: Ver ingresos del mes, semana o d√≠a.

### 2. Reporte de Deudores (`/treasury/reports/debts`)

**Qu√© muestra**: Pacientes que tienen saldo pendiente.

**Informaci√≥n por paciente**:

- Nombre del paciente
- Total adeudado
- Total pagado
- Saldo pendiente
- D√≠as de mora (si aplica)
- √öltimo pago

**Ordenamiento**:

- Por monto (mayor a menor deuda)
- Por fecha (m√°s atrasados primero)
- Alfab√©tico

**Uso t√≠pico**: Identificar pacientes para recordatorios de pago.

![Reporte de deudores.png](/images/Reportededeudores.png)

## 3. Deudas de Obras Sociales

### A. Deudas de Obras Sociales (/treasury/health-insurance-debts)

**Qu√© muestra:**\
Las deudas pendientes de cobro correspondientes a obras sociales, asociadas a pacientes y presupuestos.

**Filtros:**\
‚Ä¢ Obra social\
‚Ä¢ Estado (pendiente - cobrado)\
‚Ä¢ Rango de fechas (desde / hasta)

**Informaci√≥n:**\
‚Ä¢ Obra social\
‚Ä¢ Paciente\
‚Ä¢ Presupuesto\
‚Ä¢ Prestaci√≥n\
‚Ä¢ Monto adeudado\
‚Ä¢ Estado\
‚Ä¢ Fecha

**Uso t√≠pico:**\
Controlar las deudas pendientes de cobro de obras sociales y hacer seguimiento de los importes a recibir.

![Para El Chatcito](/images/Paraelchatcito.png)

### B. Historial de Cobros (/treasury/health-insurance-debts)

**Qu√© muestra:**\
Todos los cobros ya registrados de obras sociales en un per√≠odo determinado.

**Filtros:**\
‚Ä¢ Rango de fechas (desde / hasta)

**Informaci√≥n:**\
‚Ä¢ Fecha del cobro\
‚Ä¢ Descripci√≥n del cobro\
‚Ä¢ Cuenta destino\
‚Ä¢ Cantidad de prestaciones\
‚Ä¢ Total cobrado

**Uso t√≠pico:**\
Consultar el historial de cobros realizados a obras sociales y verificar montos ingresados en cuentas bancarias.

![Para El Chatcito 5](/images/Paraelchatcito5.png)

### 4. Reporte de Balance (`/treasury/reports/balance`)

**Qu√© muestra**: Comparaci√≥n entre ingresos y egresos.

**Informaci√≥n**:

- Total de ingresos del per√≠odo
- Total de gastos del per√≠odo
- Balance (ingresos - gastos)
- Gr√°fico de evoluci√≥n

**Filtros**:

- Rango de fechas
- Por caja

**Uso t√≠pico**: An√°lisis de rentabilidad mensual.

### 5. Reporte de Movimientos (`/treasury/accounts/banks`)

**Qu√© muestra**: Todas las transacciones (ingresos y egresos) por caja.

**Informaci√≥n**:

- Fecha de movimiento
- Tipo (Ingreso/Egreso)
- Monto
- Caja origen/destino
- Descripci√≥n
- Saldo resultante

**Filtros**:

- Rango de fechas
- Caja espec√≠fica
- Tipo de movimiento

**Uso t√≠pico**: Auditor√≠a de cajas, cuadre diario.

### 6. Reporte de Ingresos (`/treasury/reports/income`)

**Qu√© muestra**: An√°lisis detallado de cobranzas.

**Desglose**:

- Por m√©todo de pago (cu√°nto en efectivo, tarjeta, etc.)
- Por doctor (producci√≥n individual)
- Por tratamiento (qu√© genera m√°s ingresos)

**Uso t√≠pico**: Estrategia de cobranza, evaluaci√≥n de performance.

### 7. Reporte de Personal (`/treasury/reports/personal`)

**Qu√© muestra**: Producci√≥n de cada doctor.

**Informaci√≥n por doctor**:

- Cantidad de pacientes atendidos
- Cantidad de presupuestos creados
- Total facturado
- Total cobrado
- Pendiente de cobro

**Uso t√≠pico**: Liquidaci√≥n de comisiones, evaluaci√≥n de desempe√±o.

**Permiso**: `see_report_personal` (generalmente solo admin)

---

## Pagos a Doctores (`/treasury/doctor-payments`)

M√≥dulo para registrar pagos/comisiones a los profesionales.

**Funcionalidades**:

- Ver producci√≥n del doctor
- Calcular comisi√≥n seg√∫n configuraci√≥n
- Registrar pago al doctor
- Historial de pagos
- Detalle de pago (qu√© tratamientos incluy√≥)

## **Contratos**

### Creaci√≥n del contrato

Ruta:\
**Administrador ‚Üí Staff ‚Üí Contratos ‚Üí Creaci√≥n**

El contrato define **c√≥mo se calcula el pago del doctor** a partir de los presupuestos y sus acciones.

### Datos generales del contrato

En esta primera secci√≥n se configuran los datos base:

- **Tipo de contrato**\
  Ejemplo visible: **Por presupuesto**\
  Define la l√≥gica general de c√°lculo (no se modifica luego).
- **Nombre del contrato**\
  Identificador interno (ej.: ‚ÄúImplantolog√≠a ‚Äì Dr. P√©rez‚Äù).
- **Descripci√≥n**\
  Campo libre para aclaraciones administrativas o contables.

### Base de c√°lculo

Define **sobre qu√© valor se calcula el honorario**:

- üîò **Precio del presupuesto**\
  El c√°lculo se realiza sobre el valor final del presupuesto aprobado.
- ‚ö™ **Precio de la lista**\
  El c√°lculo se realiza sobre el precio base de la prestaci√≥n, independientemente de descuentos.

> Esta elecci√≥n impacta directamente en el monto final del honorario.

---

### Configuraci√≥n de pago al doctor

En esta secci√≥n se ajustan los porcentajes que afectan el c√°lculo:

- **% Paciente**\
  Porcentaje del valor pagado por el paciente que se considera para el c√°lculo.
- **% Obra Social**\
  Porcentaje del valor cubierto por obra social que se considera.
- **% Descuento Lab**\
  Ajuste aplicado cuando hay descuentos provenientes del laboratorio.

Estos valores permiten **modelar escenarios reales de cobro**, sin modificar el presupuesto original.

### Acciones del contrato

Una vez guardado el contrato:

- Se habilita la secci√≥n **Acciones del contrato**
- Se asocian las **prestaciones odontol√≥gicas**
- Para cada acci√≥n se define:
  - Porcentaje o monto fijo
  - Moneda

Estas acciones son las que luego se cruzan con los presupuestos.

### Asignaci√≥n a doctores

- El contrato se puede asignar a **uno o varios doctores**
- La relaci√≥n es flexible:
  - Si se quita un doctor ‚Üí **soft delete**
  - Si se vuelve a asignar ‚Üí **reactivaci√≥n del v√≠nculo**

### Uso en presupuestos

- Solo los presupuestos **Aprobados** o **Cerrados** generan c√°lculos.
- El sistema:
  - Toma las acciones del presupuesto
  - Las cruza con las acciones del contrato
  - Aplica base de c√°lculo + porcentajes
  - Genera los honorarios del doctor

**Ruta detalle**: `/treasury/doctor-payments/:paymentId/detail`

---

## Permisos por Funcionalidad

| Acci√≥n                   | Permiso                | Rol T√≠pico                   |
| ------------------------ | ---------------------- | ---------------------------- |
| Ver dashboard            | `list_treasury`        | Admin, Secretaria autorizada |
| Registrar pagos          | `register_payment`     | Secretaria, Admin            |
| Ver reportes de ventas   | `see_report_sales`     | Admin                        |
| Ver deudores             | `see_report_debtors`   | Admin, Secretaria            |
| Ver balance              | `see_report_movements` | Admin                        |
| Agregar gastos           | `add_expense`          | Admin                        |
| Ver reportes de personal | `see_report_personal`  | Admin, Doctor (solo propio)  |
| Gestionar cajas          | `manage_boxes`         | Admin                        |

---

## Flujo de Trabajo Diario

### Para Secretaria

1. **Al iniciar el d√≠a**:
   - Verificar saldo de cajas
   - Revisar pagos pendientes del d√≠a
2. **Durante el d√≠a**:
   - Registrar cada pago que realicen los pacientes
   - Entregar recibos
   - Actualizar balance
3. **Al cerrar**:
   - Cuadrar caja (contar efectivo f√≠sico vs sistema)
   - Reporte de movimientos del d√≠a
   - Preparar dep√≥sito bancario si corresponde

### Para Administrador

1. **Diario**:
   - Revisar dashboard de tesorer√≠a
   - Verificar que se registren todos los pagos
2. **Semanal**:
   - Reporte de ventas
   - Identificar deudores y enviar recordatorios
   - Registro de gastos de la semana
3. **Mensual**:
   - Reporte de balance completo
   - An√°lisis de rentabilidad
   - Pago de comisiones a doctores
   - Cierre contable

---

## Consejos y Mejores Pr√°cticas

### Registro de Pagos

1. **Registrar inmediatamente**: No dejes pagos sin registrar
2. **Recibos siempre**: Entrega comprobante a cada paciente
3. **Verificar m√©todo**: Confirma forma de pago con el paciente
4. **Observaciones claras**: Anota detalles relevantes

### Control de Cajas

1. **Cuadrar diariamente**: Verifica que efectivo f√≠sico = sistema
2. **Separar cajas**: Una para cada tipo (efectivo, banco, tarjeta)
3. **Depositar regularmente**: No acumules mucho efectivo en cl√≠nica
4. **Respaldos**: Guarda comprobantes f√≠sicos

### Reportes

1. **Revisar semanalmente**: No esperes al mes para detectar problemas
2. **Comparar per√≠odos**: Analiza evoluci√≥n mes a mes
3. **Seguimiento de deudores**: Contacta a pacientes con mora
4. **Exportar datos**: Guarda reportes para contabilidad externa

---

## Errores Comunes

### "El monto excede el saldo pendiente"

**Causa**: Intentas registrar m√°s de lo que el paciente debe **Soluci√≥n**: Verifica el saldo actual antes de ingresar el monto

### No puedo ver reportes financieros

**Causa**: No tienes los permisos necesarios **Soluci√≥n**: Contacta al administrador para solicitar acceso

### Las cajas no cuadran

**Causa**: Pagos no registrados o registrados incorrectamente **Soluci√≥n**: Revisa el reporte de movimientos, busca discrepancias

### El recibo no se genera

**Causa**: Datos incompletos o error del sistema **Soluci√≥n**: Verifica que todos los campos est√©n completos, refresca la p√°gina

---

## Integraci√≥n con Otros M√≥dulos

### Pacientes

- Balance del paciente en ficha
- Historial de pagos
- Deuda actual siempre visible

### Presupuestos

- Los pagos se asocian a presupuestos
- El saldo del presupuesto se actualiza autom√°ticamente
- No se puede completar presupuesto con saldo pendiente

### Citas

- (Opcional) Recordatorio de pago al agendar cita

---